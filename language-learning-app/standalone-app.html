<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immersive Language Learning System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Refined color palette - softer, more elegant */
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --primary-light: #7f9cf5;
            --secondary: #9f7aea;
            --accent: #ed64a6;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;

            /* Sophisticated background layers */
            --bg: #0a0e27;
            --bg-secondary: #1a1f3a;
            --bg-card: #242b4a;
            --bg-elevated: #2d3454;

            /* Refined text hierarchy */
            --text: #f7fafc;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --text-tertiary: #718096;
            --border: #4a5568;
            --border-light: #2d3748;

            /* Spacing system (8px base, golden ratio progression) */
            --space-xs: 0.5rem;   /* 8px */
            --space-sm: 0.75rem;  /* 12px */
            --space-md: 1rem;     /* 16px */
            --space-lg: 1.618rem; /* 26px - golden ratio */
            --space-xl: 2.618rem; /* 42px - golden ratio */
            --space-2xl: 4.236rem; /* 68px - golden ratio */

            /* Shadows for depth */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.15), 0 10px 10px rgba(0, 0, 0, 0.04);
            --shadow-glow: 0 0 20px rgba(102, 126, 234, 0.4);

            /* Transitions - smooth and purposeful */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: 500ms cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'SF Pro Display', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--bg) 0%, var(--bg-secondary) 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.618; /* Golden ratio for readability */
            letter-spacing: -0.011em; /* Refined tracking */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header - Elegant and floating */
        header {
            background: rgba(10, 14, 39, 0.85);
            backdrop-filter: blur(12px) saturate(180%);
            border-bottom: 1px solid var(--border-light);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-md);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg) var(--space-xl);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .nav-links {
            display: flex;
            gap: var(--space-xl);
            list-style: none;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: color var(--transition-base);
            cursor: pointer;
            position: relative;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width var(--transition-base);
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary);
        }

        .nav-links a.active::after,
        .nav-links a:hover::after {
            width: 100%;
        }

        /* Views */
        .view {
            display: none;
            padding: 3rem 0;
        }

        .view.active {
            display: block;
        }

        /* Home View */
        .hero {
            text-align: center;
            padding: 4rem 0;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 3rem 0;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid var(--border);
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .btn {
            padding: var(--space-md) var(--space-xl);
            border: none;
            border-radius: 0.625rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 400px;
            height: 400px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: var(--shadow-lg), var(--shadow-glow);
        }

        .btn-primary:active {
            transform: translateY(0) scale(0.98);
            transition: all var(--transition-fast);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-card);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary:active {
            transform: translateY(0);
            transition: all var(--transition-fast);
        }

        /* Learning View - New Design */
        .learning-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .progress-bar {
            background: var(--bg-elevated);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: var(--space-xl);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            height: 100%;
            transition: width var(--transition-base) ease-out;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        .learning-card {
            background: var(--bg-secondary);
            border-radius: 1.5rem;
            padding: var(--space-2xl);
            border: 1px solid var(--border-light);
            margin-bottom: var(--space-xl);
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .learning-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), var(--secondary), transparent);
            opacity: 0.6;
        }

        /* Step 1: Show definition - The hero moment */
        .definition-step {
            text-align: center;
            animation: fadeIn var(--transition-slow) ease-out;
            position: relative;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .word-status-badge {
            display: inline-block;
            padding: 0.35rem 0.85rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-lg);
        }

        .word-status-badge.new {
            background: rgba(66, 153, 225, 0.15);
            color: #4299e1;
            border: 1px solid rgba(66, 153, 225, 0.3);
        }

        .word-status-badge.review {
            background: rgba(237, 137, 54, 0.15);
            color: #ed8936;
            border: 1px solid rgba(237, 137, 54, 0.3);
        }

        .definition-prompt {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: var(--space-xl);
        }

        .definition-text {
            font-size: 2rem;
            font-weight: 300;
            line-height: 1.618;
            color: var(--text);
            margin: var(--space-2xl) 0;
            padding: var(--space-xl);
            background: var(--bg-card);
            border-radius: 1rem;
            border-left: 3px solid var(--primary);
            box-shadow: var(--shadow-md);
            position: relative;
            transition: all var(--transition-base);
        }

        .definition-text::before {
            content: '"';
            position: absolute;
            top: -0.2em;
            left: 0.3em;
            font-size: 4rem;
            color: var(--primary);
            opacity: 0.15;
            font-family: Georgia, serif;
        }

        .reveal-btn {
            padding: 1rem 2.5rem;
            font-size: 1rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all var(--transition-base);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .reveal-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .reveal-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: var(--shadow-lg), var(--shadow-glow);
        }

        .reveal-btn:hover::before {
            left: 100%;
        }

        .reveal-btn:active {
            transform: translateY(0) scale(0.98);
            transition: all var(--transition-fast);
        }

        /* Simplified - using inline styles for word content */
        .toggle-chinese-btn:hover {
            background: var(--bg-elevated) !important;
            transform: translateY(-1px);
        }

        .rating-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }

        .rating-btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        /* Settings View */
        .settings-section {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .settings-section h2 {
            margin-bottom: 1.5rem;
            color: var(--primary);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            flex: 1;
        }

        .setting-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--bg-card);
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle.active {
            background: var(--primary);
        }

        .toggle-slider {
            position: absolute;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }

        .toggle.active .toggle-slider {
            transform: translateX(30px);
        }

        select {
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            cursor: pointer;
        }

        /* Statistics View */
        .stats-detail {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .stats-detail h2 {
            margin-bottom: 1.5rem;
            color: var(--primary);
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .stats-row:last-child {
            border-bottom: none;
        }

        /* Completion Screen */
        .completion-screen {
            text-align: center;
            padding: 4rem 2rem;
        }

        .completion-icon {
            font-size: 5rem;
            margin-bottom: 2rem;
        }

        .completion-screen h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .completion-stats {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 1rem;
            margin: 2rem auto;
            max-width: 500px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .definition-text {
                font-size: 1.5rem;
            }

            .english-word {
                font-size: 2.5rem;
            }

            .rating-buttons {
                flex-direction: column;
            }

            .rating-btn {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <div class="logo">Language Learning</div>
            <ul class="nav-links">
                <li><a href="#" onclick="showView('home', event)" class="active">Home</a></li>
                <li><a href="#" onclick="showView('learning', event)">Learn</a></li>
                <li><a href="#" onclick="showView('stats', event)">Statistics</a></li>
                <li><a href="#" onclick="showView('settings', event)">Settings</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <!-- Home View -->
        <div id="home-view" class="view active">
            <div class="hero">
                <h1>Immersive Language Learning</h1>
                <p>Master English through cultural understanding and concept building</p>
                <button class="btn btn-primary" onclick="startLearning()">Start Learning</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="words-due">0</div>
                    <div class="stat-label">Due for Review</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="words-learned">0</div>
                    <div class="stat-label">Words Mastered</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="words-learning">0</div>
                    <div class="stat-label">In Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="study-streak">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>
        </div>

        <!-- Learning View - Redesigned -->
        <div id="learning-view" class="view">
            <div class="learning-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>

                <div id="learning-content">
                    <div class="learning-card">
                        <!-- SIMPLIFIED: Single container, toggle sections -->
                        <div id="word-container">
                            <!-- Status Badge - Always visible -->
                            <div class="word-status-badge" id="word-status-badge" style="margin-bottom: 2rem;"></div>

                            <!-- Definition Section -->
                            <div id="definition-section">
                                <p class="definition-prompt">What word has this meaning?</p>
                                <div class="definition-text" id="definition-display"></div>
                                <button class="reveal-btn" onclick="revealWord()">Reveal Word</button>
                            </div>

                            <!-- Word Details Section - Initially hidden -->
                            <div id="word-section" style="display: none;">
                                <h1 class="english-word" id="current-word" style="font-size: 4rem; font-weight: 700; color: #667eea; text-align: center; margin: 2rem 0;"></h1>

                                <p class="part-of-speech" id="part-of-speech" style="text-align: center; font-size: 1rem; color: #a0aec0; font-style: italic; margin-bottom: 2rem;"></p>

                                <div class="example-sentence" id="example" style="background: #242b4a; padding: 1.5rem; border-radius: 0.75rem; border-left: 4px solid #9f7aea; margin: 2rem 0; font-style: italic; font-size: 1.1rem; color: #e2e8f0;"></div>

                                <button class="toggle-chinese-btn" onclick="toggleChinese()" style="padding: 0.75rem 1.5rem; background: #242b4a; color: #f7fafc; border: 1px solid #4a5568; border-radius: 0.5rem; cursor: pointer; margin: 1rem 0;">
                                    <span id="chinese-toggle-text">Show Chinese Reference</span>
                                </button>

                                <div class="chinese-section" id="chinese-section" style="display: none; margin: 2rem 0; padding: 1.5rem; background: #242b4a; border-radius: 0.75rem;">
                                    <div style="font-size: 0.9rem; color: #a0aec0; margin-bottom: 0.5rem;">Chinese Translation:</div>
                                    <div class="chinese-words" id="chinese-words" style="font-size: 1.5rem; color: #9f7aea;"></div>
                                </div>

                                <!-- Cultural Insight -->
                                <div class="cultural-insight" id="cultural-insight" style="display: none; align-items: flex-start; gap: 0.5rem; padding: 1rem; background: rgba(237, 100, 166, 0.1); border: 1px solid rgba(237, 100, 166, 0.2); border-radius: 0.5rem; margin: 1.5rem 0;">
                                    <div style="font-size: 1.25rem;">üí°</div>
                                    <div class="insight-text" id="insight-text" style="font-size: 0.875rem; line-height: 1.5; color: #a0aec0;"></div>
                                </div>

                                <!-- Distance Visualization -->
                                <div class="distance-visualization" id="distance-viz" style="margin: 2rem 0; padding: 1.5rem; background: #242b4a; border-radius: 0.75rem; border: 1px solid #2d3748;">
                                    <div class="distance-item" style="margin: 1.5rem 0;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem; color: #a0aec0;">
                                            <span><span style="font-size: 1.2rem; opacity: 0.8;">üß†</span> Cultural Meaning Distance</span>
                                            <span id="meaning-distance-value" style="font-weight: 600; color: #e2e8f0;">0.0</span>
                                        </div>
                                        <div style="background: #2d3454; height: 10px; border-radius: 5px; overflow: hidden;">
                                            <div id="meaning-distance-bar" style="background: linear-gradient(90deg, #4299e1, #3182ce); height: 100%; width: 0%; transition: width 0.5s;"></div>
                                        </div>
                                    </div>

                                    <div class="distance-item" style="margin: 1.5rem 0;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem; color: #a0aec0;">
                                            <span><span style="font-size: 1.2rem; opacity: 0.8;">üëÅÔ∏è</span> Visual Distance</span>
                                            <span id="visual-distance-value" style="font-weight: 600; color: #e2e8f0;">0.0</span>
                                        </div>
                                        <div style="background: #2d3454; height: 10px; border-radius: 5px; overflow: hidden;">
                                            <div id="visual-distance-bar" style="background: linear-gradient(90deg, #9f7aea, #805ad5); height: 100%; width: 0%; transition: width 0.5s;"></div>
                                        </div>
                                    </div>

                                    <div class="distance-item" style="margin: 1.5rem 0;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem; color: #a0aec0;">
                                            <span><span style="font-size: 1.2rem; opacity: 0.8;">üó£Ô∏è</span> Pronunciation Distance</span>
                                            <span id="pronunciation-distance-value" style="font-weight: 600; color: #e2e8f0;">0.0</span>
                                        </div>
                                        <div style="background: #2d3454; height: 10px; border-radius: 5px; overflow: hidden;">
                                            <div id="pronunciation-distance-bar" style="background: linear-gradient(90deg, #ed64a6, #d53f8c); height: 100%; width: 0%; transition: width 0.5s;"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Rating Buttons -->
                                <div class="rating-section" id="rating-section">
                                    <p style="text-align: center; font-size: 1rem; font-weight: 500; color: #a0aec0; margin: 2rem 0 1.5rem 0;">How well do you know this word?</p>
                                    <div class="rating-buttons" style="display: flex; gap: 1rem; justify-content: center;">
                                        <button class="rating-btn good" onclick="rateWord('good')" style="flex: 1; max-width: 180px; padding: 1.5rem; border: none; border-radius: 0.75rem; font-size: 0.95rem; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #48bb78, #38a169); color: white;">I Know It</button>
                                        <button class="rating-btn normal" onclick="rateWord('normal')" style="flex: 1; max-width: 180px; padding: 1.5rem; border: none; border-radius: 0.75rem; font-size: 0.95rem; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #ed8936, #dd6b20); color: white;">Somewhat</button>
                                        <button class="rating-btn bad" onclick="rateWord('bad')" style="flex: 1; max-width: 180px; padding: 1.5rem; border: none; border-radius: 0.75rem; font-size: 0.95rem; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #f56565, #e53e3e); color: white;">New to Me</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="completion-screen" class="completion-screen" style="display: none;">
                    <div class="completion-icon">üéâ</div>
                    <h2>Session Complete!</h2>
                    <div class="completion-stats">
                        <div class="stats-row">
                            <span>Words Studied:</span>
                            <strong id="session-words">0</strong>
                        </div>
                        <div class="stats-row">
                            <span>Accuracy:</span>
                            <strong id="session-accuracy">0%</strong>
                        </div>
                        <div class="stats-row">
                            <span>Time Spent:</span>
                            <strong id="session-time">0m</strong>
                        </div>
                        <div class="stats-row" id="next-review-row" style="border-top: 1px solid var(--border); padding-top: 1rem; margin-top: 1rem;">
                            <span>Next Review:</span>
                            <strong id="next-review-info">-</strong>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="startLearning()">Start New Session</button>
                    <button class="btn btn-secondary" onclick="showView('home', event)" style="margin-top: 1rem;">Back to Home</button>
                </div>
            </div>
        </div>

        <!-- Statistics View -->
        <div id="stats-view" class="view">
            <h1 style="margin-bottom: 2rem;">Learning Statistics</h1>

            <div class="stats-detail">
                <h2>Overall Progress</h2>
                <div class="stats-row">
                    <span>Total Words in Database:</span>
                    <strong id="stats-total">0</strong>
                </div>
                <div class="stats-row">
                    <span>Words Learned:</span>
                    <strong id="stats-learned">0</strong>
                </div>
                <div class="stats-row">
                    <span>Words in Progress:</span>
                    <strong id="stats-progress">0</strong>
                </div>
                <div class="stats-row">
                    <span>Success Rate:</span>
                    <strong id="stats-success">0%</strong>
                </div>
            </div>

            <div class="stats-detail">
                <h2>Study Time</h2>
                <div class="stats-row">
                    <span>Total Study Time:</span>
                    <strong id="stats-time">0h 0m</strong>
                </div>
                <div class="stats-row">
                    <span>Average Session:</span>
                    <strong id="stats-avg-session">0m</strong>
                </div>
                <div class="stats-row">
                    <span>Study Streak:</span>
                    <strong id="stats-streak">0 days</strong>
                </div>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settings-view" class="view">
            <h1 style="margin-bottom: 2rem;">Settings</h1>

            <div class="settings-section">
                <h2>Display Preferences</h2>
                <div class="setting-item">
                    <div class="setting-label">
                        <div>Auto-show Chinese Reference</div>
                        <div class="setting-description">Automatically display Chinese translation for each word</div>
                    </div>
                    <div class="toggle" id="auto-chinese-toggle" onclick="toggleSetting('autoChinese', event)">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-label">
                        <div>Show Distance Visualization</div>
                        <div class="setting-description">Display cultural distance metrics for each word</div>
                    </div>
                    <div class="toggle active" id="show-distance-toggle" onclick="toggleSetting('showDistance', event)">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h2>Learning Configuration</h2>
                <div class="setting-item">
                    <span>Words Per Session</span>
                    <select id="words-per-session" onchange="saveSetting('wordsPerSession', this.value)">
                        <option value="5">5 words</option>
                        <option value="10">10 words</option>
                        <option value="15" selected>15 words</option>
                        <option value="20">20 words</option>
                        <option value="30">30 words</option>
                    </select>
                </div>
                <div class="setting-item">
                    <div class="setting-label">
                        <div>Learning Order</div>
                        <div class="setting-description">How words are selected for each session</div>
                    </div>
                    <select id="learning-mode" onchange="saveSetting('learningMode', this.value)">
                        <option value="adaptive" selected>Adaptive (SRS)</option>
                        <option value="random">Random Selection</option>
                        <option value="sequential">Sequential (A to Z)</option>
                        <option value="difficulty">By Difficulty (Easy First)</option>
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <h2>Data Management</h2>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="exportData()">Export Progress</button>
                    <button class="btn btn-secondary" onclick="importData()">Import Progress</button>
                    <button class="btn btn-secondary" onclick="resetProgress()" style="background: var(--danger); color: white;">Reset All Data</button>
                </div>
            </div>
        </div>
    </main>

    <script src="vocabulary-data.js"></script>
    <script>
        // Application State
        let appState = {
            currentSession: [],
            currentIndex: 0,
            wordsLearned: new Set(),
            wordProgress: {}, // Enhanced with SRS data
            settings: {
                autoChinese: false,
                showDistance: true,
                wordsPerSession: 15,
                learningMode: 'adaptive', // Changed default to adaptive
                reviewMixRatio: 0.3 // 30% review, 70% new
            },
            stats: {
                totalTime: 0,
                sessions: 0,
                correctAnswers: 0,
                totalAnswers: 0,
                lastStudyDate: null,
                streak: 0
            },
            sessionStartTime: null,
            sessionStats: {
                correct: 0,
                total: 0
            },
            currentWordRevealed: false
        };

        // Cultural Insights - Cross-cultural understanding hints
        const culturalInsights = {
            // High meaning distance words with cultural context
            "home": "English 'home' focuses on physical space + emotional belonging. Chinese 'ÂÆ∂' includes family relationships, filial duty, and ancestral continuity.",
            "family": "Western 'family' often means nuclear family (parents + children). Chinese 'ÂÆ∂Â∫≠/ÂÆ∂Êóè' includes extended family as active, obligatory relationships.",
            "privacy": "Western concept of personal space and individual boundaries. Less direct equivalent in Chinese culture, which values collective harmony.",
            "friend": "English 'friend' can be casual acquaintances. Chinese 'ÊúãÂèã' often implies deeper commitment and mutual obligations.",
            "face": "While English has 'lose face', Chinese 'Èù¢Â≠ê' is a complex social currency affecting all interactions and decisions.",
            "respect": "English respect is earned through achievement. Chinese 'Â∞äÈáç' is hierarchical, based on age, position, and relationship.",
            "love": "English 'love' is openly expressed emotion. Chinese 'Áà±' is often shown through actions and care rather than words.",
            "success": "Western success: individual achievement. Chinese success: family honor, social harmony, multi-generational impact.",
            "time": "English treats time as commodity ('time is money'). Chinese views time as cyclical, relational ('right time for right things').",
            "individual": "Core Western value. Chinese equivalent '‰∏™‰∫∫' exists but within collective context - individual through relationships.",
            "freedom": "Western freedom: from constraints. Chinese perspective includes freedom within social roles and responsibilities.",
            "duty": "English duty: obligation. Chinese 'Ë¥£‰ªª/Êú¨ÂàÜ' is identity - who you are defines what you must do.",
        };

        // Get cultural insight for a word
        function getCulturalInsight(word, meaningDistance) {
            // Only show insights for high cultural distance words
            if (meaningDistance >= 0.35 && culturalInsights[word.toLowerCase()]) {
                return culturalInsights[word.toLowerCase()];
            }
            return null;
        }

        // SRS Algorithm - Simplified SuperMemo SM-2
        function calculateNextReview(word, rating) {
            const progress = appState.wordProgress[word] || {
                interval: 1, // Days until next review
                easeFactor: 2.5, // Difficulty multiplier
                repetitions: 0, // Successful repetitions count
                nextReview: Date.now(),
                lastReview: null
            };

            let { interval, easeFactor, repetitions } = progress;

            if (rating === 'good') { // Quality: 5 (perfect)
                repetitions++;
                if (repetitions === 1) {
                    interval = 1;
                } else if (repetitions === 2) {
                    interval = 6;
                } else {
                    interval = Math.round(interval * easeFactor);
                }
                easeFactor = Math.max(1.3, easeFactor + 0.1);
            } else if (rating === 'normal') { // Quality: 3 (recalled with difficulty)
                interval = Math.max(1, Math.round(interval * 0.5));
                easeFactor = Math.max(1.3, easeFactor - 0.15);
            } else { // rating === 'bad', Quality: 0 (complete blank)
                repetitions = 0;
                interval = 1;
                easeFactor = Math.max(1.3, easeFactor - 0.2);
            }

            return {
                interval,
                easeFactor: Math.round(easeFactor * 100) / 100,
                repetitions,
                nextReview: Date.now() + (interval * 24 * 60 * 60 * 1000),
                lastReview: Date.now(),
                totalReviews: (progress.totalReviews || 0) + 1,
                ratings: [...(progress.ratings || []), rating]
            };
        }

        // Get words due for review
        function getDueWords() {
            const now = Date.now();
            return Object.keys(appState.wordProgress)
                .filter(word => {
                    const progress = appState.wordProgress[word];
                    return progress.nextReview && progress.nextReview <= now;
                })
                .map(word => {
                    const wordData = completeVocabularyData.find(w => w.english === word);
                    return { ...wordData, priority: 'review' };
                });
        }

        // Get new words (not yet studied)
        function getNewWords() {
            return completeVocabularyData.filter(w =>
                !appState.wordProgress[w.english] &&
                !appState.wordsLearned.has(w.english)
            );
        }

        // Adaptive word selection - mix reviews and new words
        function selectAdaptiveWords(count) {
            const dueWords = getDueWords();
            const newWords = getNewWords();

            const reviewCount = Math.min(
                Math.ceil(count * appState.settings.reviewMixRatio),
                dueWords.length
            );
            const newCount = Math.min(count - reviewCount, newWords.length);

            // Prioritize due reviews
            const selected = [
                ...dueWords.slice(0, reviewCount),
                ...newWords.slice(0, newCount)
            ];

            // Shuffle to mix reviews and new words
            return selected.sort(() => Math.random() - 0.5);
        }

        // Load data from localStorage
        function loadData() {
            try {
                const saved = localStorage.getItem('languageLearningData');
                if (saved && saved !== 'null') {
                    const data = JSON.parse(saved);
                    appState.wordsLearned = new Set(data.wordsLearned || []);
                    appState.wordProgress = data.wordProgress || {};
                    appState.settings = { ...appState.settings, ...(data.settings || {}) };
                    appState.stats = { ...appState.stats, ...(data.stats || {}) };
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
            updateStats();
        }

        // Save data to localStorage
        function saveData() {
            const data = {
                wordsLearned: Array.from(appState.wordsLearned),
                wordProgress: appState.wordProgress,
                settings: appState.settings,
                stats: appState.stats
            };
            localStorage.setItem('languageLearningData', JSON.stringify(data));
        }

        // Show view
        function showView(viewName, e) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));

            document.getElementById(`${viewName}-view`).classList.add('active');

            if (e && e.target) {
                e.target.classList.add('active');
            } else {
                const navLinks = document.querySelectorAll('.nav-links a');
                navLinks.forEach(link => {
                    if (link.getAttribute('onclick').includes(viewName)) {
                        link.classList.add('active');
                    }
                });
            }

            if (viewName === 'stats') {
                updateStatsView();
            } else if (viewName === 'settings') {
                updateSettingsView();
            }
        }

        // Start learning session with SRS
        function startLearning() {
            if (!completeVocabularyData || completeVocabularyData.length === 0) {
                alert('Vocabulary data is still loading. Please wait a moment and try again.');
                return;
            }

            showView('learning');

            const wordCount = parseInt(appState.settings.wordsPerSession);
            let selectedWords = [];

            if (appState.settings.learningMode === 'adaptive') {
                // Use SRS adaptive selection
                selectedWords = selectAdaptiveWords(wordCount);
            } else if (appState.settings.learningMode === 'sequential') {
                // Sequential mode - A to Z
                let availableWords = completeVocabularyData.filter(w => !appState.wordsLearned.has(w.english));
                if (availableWords.length === 0) {
                    availableWords = completeVocabularyData;
                }
                selectedWords = availableWords.slice(0, wordCount);
            } else if (appState.settings.learningMode === 'random') {
                // Random selection
                let availableWords = completeVocabularyData.filter(w => !appState.wordsLearned.has(w.english));
                if (availableWords.length === 0) {
                    availableWords = completeVocabularyData;
                }
                selectedWords = availableWords
                    .sort(() => Math.random() - 0.5)
                    .slice(0, wordCount);
            } else if (appState.settings.learningMode === 'difficulty') {
                // By difficulty
                let availableWords = completeVocabularyData.filter(w => !appState.wordsLearned.has(w.english));
                if (availableWords.length === 0) {
                    availableWords = completeVocabularyData;
                }
                selectedWords = availableWords
                    .sort((a, b) => (a.totalDistance || 0) - (b.totalDistance || 0))
                    .slice(0, wordCount);
            }

            appState.currentSession = selectedWords;
            appState.currentIndex = 0;
            appState.sessionStartTime = Date.now();
            appState.sessionStats = { correct: 0, total: 0 };

            document.getElementById('learning-content').style.display = 'block';
            document.getElementById('completion-screen').style.display = 'none';

            showNextWord();
        }

        // Show next word - SIMPLIFIED
        function showNextWord() {
            if (appState.currentIndex >= appState.currentSession.length) {
                completeSession();
                return;
            }

            const word = appState.currentSession[appState.currentIndex];
            const progress = (appState.currentIndex / appState.currentSession.length) * 100;

            // Reset state
            appState.currentWordRevealed = false;

            // Update progress bar
            document.getElementById('progress-fill').style.width = `${progress}%`;

            // Show definition section, hide word section
            document.getElementById('definition-section').style.display = 'block';
            document.getElementById('word-section').style.display = 'none';
            document.getElementById('chinese-section').style.display = 'none';

            // Set definition
            document.getElementById('definition-display').textContent = word.definition;

            // Show word status badge
            const badge = document.getElementById('word-status-badge');
            const isReview = appState.wordProgress[word.english] && appState.wordProgress[word.english].lastReview;
            badge.textContent = isReview ? 'REVIEW' : 'NEW';
            badge.className = 'word-status-badge ' + (isReview ? 'review' : 'new');

            // Populate word details (while hidden)
            document.getElementById('current-word').textContent = word.english;
            document.getElementById('part-of-speech').textContent = word.partOfSpeech;
            document.getElementById('example').textContent = `"${word.example}"`;
            document.getElementById('chinese-words').textContent = word.chinese.join(', ');

            // Update distance bars
            document.getElementById('meaning-distance-value').textContent = word.meaningDistance.toFixed(2);
            document.getElementById('meaning-distance-bar').style.width = `${word.meaningDistance * 100}%`;

            document.getElementById('visual-distance-value').textContent = word.visualDistance.toFixed(2);
            document.getElementById('visual-distance-bar').style.width = `${word.visualDistance * 100}%`;

            document.getElementById('pronunciation-distance-value').textContent = word.pronunciationDistance.toFixed(2);
            document.getElementById('pronunciation-distance-bar').style.width = `${word.pronunciationDistance * 100}%`;

            // Show/hide distance visualization based on settings
            document.getElementById('distance-viz').style.display = appState.settings.showDistance ? 'block' : 'none';

            // Show cultural insight if available
            const insight = getCulturalInsight(word.english, word.meaningDistance);
            const insightElement = document.getElementById('cultural-insight');
            if (insight) {
                document.getElementById('insight-text').textContent = insight;
                insightElement.style.display = 'flex';
            } else {
                insightElement.style.display = 'none';
            }

            // Reset Chinese toggle
            document.getElementById('chinese-toggle-text').textContent = 'Show Chinese Reference';

            // Auto-show Chinese if setting enabled
            if (appState.settings.autoChinese) {
                document.getElementById('chinese-section').style.display = 'block';
                document.getElementById('chinese-toggle-text').textContent = 'Hide Chinese Reference';
            }
        }

        // Reveal word - ULTRA SIMPLE
        function revealWord() {
            appState.currentWordRevealed = true;

            // Hide definition, show word
            document.getElementById('definition-section').style.display = 'none';
            document.getElementById('word-section').style.display = 'block';
        }

        // Toggle Chinese reference - SIMPLE
        function toggleChinese() {
            const section = document.getElementById('chinese-section');
            const text = document.getElementById('chinese-toggle-text');

            if (section.style.display === 'none') {
                section.style.display = 'block';
                text.textContent = 'Hide Chinese Reference';
            } else {
                section.style.display = 'none';
                text.textContent = 'Show Chinese Reference';
            }
        }

        // Rate word with SRS algorithm
        function rateWord(rating) {
            const word = appState.currentSession[appState.currentIndex];

            // Update SRS data using SuperMemo SM-2 algorithm
            appState.wordProgress[word.english] = calculateNextReview(word.english, rating);

            // Mark as learned if repetitions >= 3 with good ratings
            const progress = appState.wordProgress[word.english];
            if (progress.repetitions >= 3) {
                appState.wordsLearned.add(word.english);
            }

            // Update session stats
            appState.stats.totalAnswers++;
            appState.sessionStats.total++;
            if (rating === 'good') {
                appState.stats.correctAnswers++;
                appState.sessionStats.correct++;
            }

            saveData();
            appState.currentIndex++;
            showNextWord();
        }

        // Complete session with SRS insights
        function completeSession() {
            document.getElementById('learning-content').style.display = 'none';
            document.getElementById('completion-screen').style.display = 'block';

            const sessionTime = Math.round((Date.now() - appState.sessionStartTime) / 60000);
            const sessionAccuracy = appState.sessionStats.total > 0 ?
                Math.round((appState.sessionStats.correct / appState.sessionStats.total) * 100) : 0;

            document.getElementById('session-words').textContent = appState.sessionStats.total;
            document.getElementById('session-accuracy').textContent = `${sessionAccuracy}%`;
            document.getElementById('session-time').textContent = `${sessionTime}m`;

            // Calculate next review info
            const dueWords = getDueWords();
            const allProgress = Object.values(appState.wordProgress);
            if (allProgress.length > 0 && dueWords.length === 0) {
                // Find nearest review date
                const nextReviews = allProgress
                    .filter(p => p.nextReview)
                    .map(p => p.nextReview)
                    .sort((a, b) => a - b);

                if (nextReviews.length > 0) {
                    const nextReview = nextReviews[0];
                    const hoursUntil = Math.round((nextReview - Date.now()) / (1000 * 60 * 60));

                    if (hoursUntil < 24) {
                        document.getElementById('next-review-info').textContent = `${hoursUntil}h`;
                    } else {
                        const daysUntil = Math.round(hoursUntil / 24);
                        document.getElementById('next-review-info').textContent = `${daysUntil} day${daysUntil > 1 ? 's' : ''}`;
                    }
                } else {
                    document.getElementById('next-review-info').textContent = 'No reviews scheduled';
                }
            } else if (dueWords.length > 0) {
                document.getElementById('next-review-info').textContent = `${dueWords.length} word${dueWords.length > 1 ? 's' : ''} now`;
            } else {
                document.getElementById('next-review-info').textContent = 'Start learning!';
            }

            appState.stats.totalTime += sessionTime;
            appState.stats.sessions++;

            const today = new Date().toDateString();
            if (appState.stats.lastStudyDate !== today) {
                const yesterday = new Date(Date.now() - 86400000).toDateString();
                if (appState.stats.lastStudyDate === yesterday) {
                    appState.stats.streak++;
                } else if (appState.stats.lastStudyDate !== today) {
                    appState.stats.streak = 1;
                }
                appState.stats.lastStudyDate = today;
            }

            saveData();
            updateStats();
        }

        // Update statistics with SRS data
        function updateStats() {
            // Words due for review
            const dueWords = getDueWords();
            document.getElementById('words-due').textContent = dueWords.length;

            // Words mastered (repetitions >= 3)
            document.getElementById('words-learned').textContent = appState.wordsLearned.size;

            // Words in progress (started but not mastered)
            const wordsInProgress = Object.keys(appState.wordProgress).length - appState.wordsLearned.size;
            document.getElementById('words-learning').textContent = Math.max(0, wordsInProgress);

            // Study streak
            document.getElementById('study-streak').textContent = appState.stats.streak;
        }

        // Update stats view
        function updateStatsView() {
            document.getElementById('stats-total').textContent = completeVocabularyData.length;
            document.getElementById('stats-learned').textContent = appState.wordsLearned.size;
            document.getElementById('stats-progress').textContent = Object.keys(appState.wordProgress).length;

            const successRate = appState.stats.totalAnswers > 0 ?
                Math.round((appState.stats.correctAnswers / appState.stats.totalAnswers) * 100) : 0;
            document.getElementById('stats-success').textContent = `${successRate}%`;

            const hours = Math.floor(appState.stats.totalTime / 60);
            const minutes = appState.stats.totalTime % 60;
            document.getElementById('stats-time').textContent = `${hours}h ${minutes}m`;

            const avgSession = appState.stats.sessions > 0 ?
                Math.round(appState.stats.totalTime / appState.stats.sessions) : 0;
            document.getElementById('stats-avg-session').textContent = `${avgSession}m`;

            document.getElementById('stats-streak').textContent = `${appState.stats.streak} days`;
        }

        // Update settings view
        function updateSettingsView() {
            document.getElementById('auto-chinese-toggle').classList.toggle('active', appState.settings.autoChinese);
            document.getElementById('show-distance-toggle').classList.toggle('active', appState.settings.showDistance);
            document.getElementById('words-per-session').value = appState.settings.wordsPerSession;
            document.getElementById('learning-mode').value = appState.settings.learningMode;
        }

        // Toggle setting
        function toggleSetting(setting, e) {
            appState.settings[setting] = !appState.settings[setting];
            if (e && e.target) {
                e.target.classList.toggle('active');
            }
            saveData();
        }

        // Save setting
        function saveSetting(setting, value) {
            if (setting === 'wordsPerSession') {
                appState.settings[setting] = parseInt(value);
            } else {
                appState.settings[setting] = value;
            }
            saveData();
        }

        // Export data
        function exportData() {
            const data = localStorage.getItem('languageLearningData');
            if (!data || data === 'null') {
                alert('No progress data to export yet. Start learning first!');
                return;
            }
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `language-learning-progress-${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert('Progress exported successfully!');
        }

        // Import data
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = e => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (!data.wordsLearned || !data.stats) {
                            alert('Invalid progress file format.');
                            return;
                        }
                        localStorage.setItem('languageLearningData', event.target.result);
                        loadData();
                        alert('Progress imported successfully!');
                        location.reload();
                    } catch (error) {
                        alert('Error importing file: Invalid JSON format.');
                        console.error('Import error:', error);
                    }
                };
                reader.onerror = () => {
                    alert('Error reading file.');
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Reset progress
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                localStorage.removeItem('languageLearningData');
                location.reload();
            }
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
