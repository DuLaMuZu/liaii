<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­è¨€å­¦ä¹ ç³»ç»Ÿ - å®Œæ•´ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-900: #111827;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            color: var(--gray-900);
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .navbar {
            background: white;
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
        }

        .nav-tab {
            padding: 10px 20px;
            border-radius: 10px;
            background: var(--gray-100);
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-tab:hover {
            background: var(--gray-200);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        /* ä¸»å®¹å™¨ */
        .main-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* é¦–é¡µè§†å›¾ */
        .home-view {
            padding: 50px;
            text-align: center;
        }

        .home-title {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .home-subtitle {
            font-size: 20px;
            color: var(--gray-600);
            margin-bottom: 40px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .stat-box {
            background: var(--gray-50);
            padding: 30px;
            border-radius: 12px;
            border: 2px solid var(--gray-200);
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
        }

        .stat-number {
            font-size: 48px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 16px;
            color: var(--gray-600);
            font-weight: 600;
        }

        .start-button {
            padding: 18px 50px;
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
        }

        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        /* å­¦ä¹ è§†å›¾ */
        .learning-view {
            padding: 40px;
        }

        .progress-bar-container {
            background: var(--gray-100);
            height: 12px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .progress-text {
            text-align: center;
            margin-bottom: 15px;
            font-size: 16px;
            color: var(--gray-600);
            font-weight: 600;
        }

        .word-card {
            background: var(--gray-50);
            padding: 50px;
            border-radius: 16px;
            margin: 30px 0;
            text-align: center;
            border: 3px solid var(--gray-200);
        }

        .word-main {
            font-size: 64px;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 20px;
        }

        .word-meta {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            display: inline-block;
        }

        .badge-level {
            background: var(--success);
            color: white;
        }

        .badge-level.a2 {
            background: var(--warning);
        }

        .badge-pos {
            background: var(--primary);
            color: white;
        }

        .word-chinese {
            font-size: 32px;
            color: var(--gray-700);
            margin-bottom: 25px;
            font-weight: 600;
        }

        .show-translation-btn {
            padding: 12px 30px;
            background: var(--gray-200);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }

        .show-translation-btn:hover {
            background: var(--gray-300);
        }

        .translation-hidden {
            filter: blur(8px);
            user-select: none;
        }

        .word-definition {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: left;
            font-size: 18px;
            line-height: 1.8;
            color: var(--gray-700);
        }

        .word-example {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            padding: 25px;
            border-radius: 12px;
            font-style: italic;
            font-size: 18px;
            line-height: 1.8;
            color: var(--gray-700);
            border-left: 4px solid var(--primary);
        }

        .scores-section {
            margin: 30px 0;
        }

        .scores-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--gray-800);
        }

        .scores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .score-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .score-label {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .score-bar {
            height: 12px;
            background: var(--gray-200);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .score-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        /* è¯„åˆ†æŒ‰é’® */
        .rating-section {
            margin-top: 40px;
        }

        .rating-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            color: var(--gray-800);
        }

        .rating-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .rating-btn {
            padding: 20px;
            font-size: 18px;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .rating-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .rating-btn.bad {
            background: var(--danger);
            color: white;
        }

        .rating-btn.normal {
            background: var(--warning);
            color: white;
        }

        .rating-btn.good {
            background: var(--success);
            color: white;
        }

        /* è¯æ±‡åº“è§†å›¾ */
        .library-view {
            padding: 40px;
        }

        .search-bar {
            width: 100%;
            padding: 18px 25px;
            font-size: 16px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .word-list {
            display: grid;
            gap: 20px;
        }

        .word-item {
            background: var(--gray-50);
            padding: 25px;
            border-radius: 12px;
            border: 2px solid var(--gray-200);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .word-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
        }

        .word-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .word-item-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .word-item-content {
            color: var(--gray-600);
            line-height: 1.6;
        }

        /* ç»Ÿè®¡è§†å›¾ */
        .stats-view {
            padding: 40px;
        }

        .stats-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .stats-view-title {
            font-size: 36px;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 10px;
        }

        .stats-view-subtitle {
            font-size: 18px;
            color: var(--gray-600);
        }

        /* å®Œæˆè§†å›¾ */
        .completion-view {
            padding: 60px;
            text-align: center;
        }

        .completion-icon {
            font-size: 100px;
            margin-bottom: 30px;
        }

        .completion-title {
            font-size: 42px;
            font-weight: 800;
            color: var(--success);
            margin-bottom: 20px;
        }

        .completion-message {
            font-size: 20px;
            color: var(--gray-600);
            margin-bottom: 40px;
        }

        .completion-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .home-title {
                font-size: 32px;
            }

            .word-main {
                font-size: 42px;
            }

            .word-chinese {
                font-size: 24px;
            }

            .rating-buttons {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                width: 100%;
                justify-content: space-between;
            }
        }

        .hidden {
            display: none !important;
        }

        /* åŠ è½½åŠ¨ç”» */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- å¯¼èˆªæ  -->
        <nav class="navbar">
            <div class="logo">ğŸ“ è¯­è¨€å­¦ä¹ ç³»ç»Ÿ</div>
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchView('home')">é¦–é¡µ</button>
                <button class="nav-tab" onclick="switchView('library')">è¯æ±‡åº“</button>
                <button class="nav-tab" onclick="switchView('stats')">ç»Ÿè®¡</button>
            </div>
        </nav>

        <!-- ä¸»å®¹å™¨ -->
        <div class="main-container">
            <!-- é¦–é¡µè§†å›¾ -->
            <div id="homeView" class="home-view">
                <h1 class="home-title">æ¬¢è¿ä½¿ç”¨è¯­è¨€å­¦ä¹ ç³»ç»Ÿ</h1>
                <p class="home-subtitle">åŸºäºä¸‰ç»´æ–‡åŒ–è·ç¦»è¯„åˆ†çš„æ™ºèƒ½å­¦ä¹ å¹³å°</p>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-number" id="totalWords">250</div>
                        <div class="stat-label">æ€»è¯æ±‡é‡</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="learnedWords">0</div>
                        <div class="stat-label">å·²å­¦ä¹ </div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="masteredWords">0</div>
                        <div class="stat-label">å·²æŒæ¡</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="learningProgress">0%</div>
                        <div class="stat-label">å­¦ä¹ è¿›åº¦</div>
                    </div>
                </div>

                <button class="start-button" onclick="startLearning()">
                    ğŸš€ å¼€å§‹å­¦ä¹ 
                </button>
            </div>

            <!-- å­¦ä¹ è§†å›¾ -->
            <div id="learningView" class="learning-view hidden">
                <div class="progress-text">
                    <span id="currentWordIndex">1</span> / <span id="totalWordsCount">250</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>

                <div class="word-card fade-in" id="wordCard">
                    <div class="word-main" id="wordEnglish">Loading...</div>
                    <div class="word-meta">
                        <span class="badge badge-level" id="wordLevel">A1</span>
                        <span class="badge badge-pos" id="wordPos">n.</span>
                    </div>

                    <button class="show-translation-btn" onclick="toggleTranslation()">
                        æ˜¾ç¤º/éšè—ç¿»è¯‘
                    </button>

                    <div class="word-chinese" id="wordChinese">åŠ è½½ä¸­...</div>

                    <div class="word-definition" id="wordDefinition">
                        <strong>è‹±æ–‡é‡Šä¹‰ï¼š</strong>Loading...
                    </div>

                    <div class="word-example" id="wordExample">
                        <strong>ä¾‹å¥ï¼š</strong>"Loading..."
                    </div>

                    <div class="scores-section">
                        <div class="scores-title">ğŸ“Š ä¸‰ç»´éš¾åº¦è¯„åˆ†</div>
                        <div class="scores-grid">
                            <div class="score-card">
                                <div class="score-label">å«ä¹‰è·ç¦»</div>
                                <div class="score-bar">
                                    <div class="score-fill" id="meaningScore"></div>
                                </div>
                                <div class="score-value" id="meaningValue">0.00</div>
                            </div>
                            <div class="score-card">
                                <div class="score-label">è§†è§‰è·ç¦»</div>
                                <div class="score-bar">
                                    <div class="score-fill" id="visualScore"></div>
                                </div>
                                <div class="score-value" id="visualValue">0.00</div>
                            </div>
                            <div class="score-card">
                                <div class="score-label">è¯»éŸ³è·ç¦»</div>
                                <div class="score-bar">
                                    <div class="score-fill" id="pronunciationScore"></div>
                                </div>
                                <div class="score-value" id="pronunciationValue">0.00</div>
                            </div>
                            <div class="score-card">
                                <div class="score-label">ç»¼åˆéš¾åº¦</div>
                                <div class="score-bar">
                                    <div class="score-fill" id="totalScore"></div>
                                </div>
                                <div class="score-value" id="totalValue">0.00</div>
                            </div>
                        </div>
                    </div>

                    <div class="rating-section">
                        <div class="rating-title">ğŸ’­ è¯„ä»·è¿™ä¸ªå•è¯çš„æŒæ¡ç¨‹åº¦</div>
                        <div class="rating-buttons">
                            <button class="rating-btn bad" onclick="rateWord('bad')">
                                ğŸ˜• ä¸ç†Ÿæ‚‰
                            </button>
                            <button class="rating-btn normal" onclick="rateWord('normal')">
                                ğŸ˜ ä¸€èˆ¬
                            </button>
                            <button class="rating-btn good" onclick="rateWord('good')">
                                ğŸ˜Š æŒæ¡äº†
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¯æ±‡åº“è§†å›¾ -->
            <div id="libraryView" class="library-view hidden">
                <input type="text" class="search-bar" id="searchInput" placeholder="ğŸ” æœç´¢å•è¯ï¼ˆæ”¯æŒä¸­è‹±æ–‡ï¼‰..." oninput="filterLibrary()">

                <div class="filters">
                    <button class="filter-btn active" onclick="filterByLevel('all')">å…¨éƒ¨</button>
                    <button class="filter-btn" onclick="filterByLevel('A1')">A1çº§åˆ«</button>
                    <button class="filter-btn" onclick="filterByLevel('A2')">A2çº§åˆ«</button>
                    <button class="filter-btn" onclick="filterByPos('n.')">åè¯</button>
                    <button class="filter-btn" onclick="filterByPos('v.')">åŠ¨è¯</button>
                    <button class="filter-btn" onclick="filterByPos('adj.')">å½¢å®¹è¯</button>
                </div>

                <div class="word-list" id="wordList"></div>
            </div>

            <!-- ç»Ÿè®¡è§†å›¾ -->
            <div id="statsView" class="stats-view hidden">
                <div class="stats-header">
                    <h2 class="stats-view-title">å­¦ä¹ ç»Ÿè®¡</h2>
                    <p class="stats-view-subtitle">æŸ¥çœ‹æ‚¨çš„å­¦ä¹ è¿›åº¦å’Œæˆå°±</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-number" id="statsTotal">250</div>
                        <div class="stat-label">æ€»è¯æ±‡é‡</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="statsLearned">0</div>
                        <div class="stat-label">å·²å­¦ä¹ </div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="statsMastered">0</div>
                        <div class="stat-label">å·²æŒæ¡</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="statsProgress">0%</div>
                        <div class="stat-label">å®Œæˆåº¦</div>
                    </div>
                </div>
            </div>

            <!-- å®Œæˆè§†å›¾ -->
            <div id="completionView" class="completion-view hidden">
                <div class="completion-icon">ğŸ‰</div>
                <h1 class="completion-title">æ­å–œå®Œæˆå­¦ä¹ ï¼</h1>
                <p class="completion-message">æ‚¨å·²ç»å®Œæˆäº†æœ¬æ¬¡å­¦ä¹ ä»»åŠ¡</p>

                <div class="completion-stats">
                    <div class="stat-box">
                        <div class="stat-number" id="completionLearned">0</div>
                        <div class="stat-label">æœ¬æ¬¡å­¦ä¹ </div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="completionGood">0</div>
                        <div class="stat-label">æŒæ¡è‰¯å¥½</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="completionNormal">0</div>
                        <div class="stat-label">ä¸€èˆ¬æŒæ¡</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="completionBad">0</div>
                        <div class="stat-label">éœ€è¦å¤ä¹ </div>
                    </div>
                </div>

                <button class="start-button" onclick="returnHome()">
                    è¿”å›é¦–é¡µ
                </button>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        // åº”ç”¨çŠ¶æ€
        let currentView = 'home';
        let currentWordIndex = 0;
        let learningWords = [];
        let translationVisible = true;
        let sessionStats = {
            learned: 0,
            good: 0,
            normal: 0,
            bad: 0
        };
        let userProgress = {
            learned: new Set(),
            mastered: new Set()
        };

        // åŠ è½½è¿›åº¦
        function loadProgress() {
            const saved = localStorage.getItem('learningProgress');
            if (saved) {
                const data = JSON.parse(saved);
                userProgress.learned = new Set(data.learned);
                userProgress.mastered = new Set(data.mastered);
            }
        }

        // ä¿å­˜è¿›åº¦
        function saveProgress() {
            const data = {
                learned: Array.from(userProgress.learned),
                mastered: Array.from(userProgress.mastered)
            };
            localStorage.setItem('learningProgress', JSON.stringify(data));
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const total = vocabularyData.length;
            const learned = userProgress.learned.size;
            const mastered = userProgress.mastered.size;
            const progress = Math.round((learned / total) * 100);

            document.getElementById('totalWords').textContent = total;
            document.getElementById('learnedWords').textContent = learned;
            document.getElementById('masteredWords').textContent = mastered;
            document.getElementById('learningProgress').textContent = progress + '%';

            document.getElementById('statsTotal').textContent = total;
            document.getElementById('statsLearned').textContent = learned;
            document.getElementById('statsMastered').textContent = mastered;
            document.getElementById('statsProgress').textContent = progress + '%';
        }

        // åˆ‡æ¢è§†å›¾
        function switchView(view) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('homeView').classList.add('hidden');
            document.getElementById('learningView').classList.add('hidden');
            document.getElementById('libraryView').classList.add('hidden');
            document.getElementById('statsView').classList.add('hidden');
            document.getElementById('completionView').classList.add('hidden');

            currentView = view;

            if (view === 'home') {
                document.getElementById('homeView').classList.remove('hidden');
                updateStats();
            } else if (view === 'library') {
                document.getElementById('libraryView').classList.remove('hidden');
                renderLibrary();
            } else if (view === 'stats') {
                document.getElementById('statsView').classList.remove('hidden');
                updateStats();
            }
        }

        // å¼€å§‹å­¦ä¹ 
        function startLearning() {
            learningWords = [...vocabularyData].sort(() => Math.random() - 0.5).slice(0, 20);
            currentWordIndex = 0;
            sessionStats = { learned: 0, good: 0, normal: 0, bad: 0 };

            document.getElementById('homeView').classList.add('hidden');
            document.getElementById('learningView').classList.remove('hidden');
            document.getElementById('totalWordsCount').textContent = learningWords.length;

            showWord();
        }

        // æ˜¾ç¤ºå•è¯
        function showWord() {
            if (currentWordIndex >= learningWords.length) {
                showCompletion();
                return;
            }

            const word = learningWords[currentWordIndex];
            const totalDistance = calculateTotalDistance(word);

            document.getElementById('wordEnglish').textContent = word.english;
            document.getElementById('wordLevel').textContent = word.level;
            document.getElementById('wordLevel').className = 'badge badge-level' + (word.level === 'A2' ? ' a2' : '');
            document.getElementById('wordPos').textContent = word.partOfSpeech;
            document.getElementById('wordChinese').textContent = word.chinese.join('ã€');
            document.getElementById('wordDefinition').innerHTML = '<strong>è‹±æ–‡é‡Šä¹‰ï¼š</strong>' + word.definition;
            document.getElementById('wordExample').innerHTML = '<strong>ä¾‹å¥ï¼š</strong>"' + word.example + '"';

            document.getElementById('meaningScore').style.width = (word.meaningDistance * 100) + '%';
            document.getElementById('meaningValue').textContent = word.meaningDistance.toFixed(2);
            document.getElementById('visualScore').style.width = (word.visualDistance * 100) + '%';
            document.getElementById('visualValue').textContent = word.visualDistance.toFixed(2);
            document.getElementById('pronunciationScore').style.width = (word.pronunciationDistance * 100) + '%';
            document.getElementById('pronunciationValue').textContent = word.pronunciationDistance.toFixed(2);
            document.getElementById('totalScore').style.width = (totalDistance * 100) + '%';
            document.getElementById('totalValue').textContent = totalDistance.toFixed(2);

            document.getElementById('currentWordIndex').textContent = currentWordIndex + 1;
            document.getElementById('progressBar').style.width = ((currentWordIndex / learningWords.length) * 100) + '%';

            translationVisible = true;
        }

        // è®¡ç®—æ€»è·ç¦»
        function calculateTotalDistance(word) {
            return 0.4 * word.meaningDistance + 0.3 * word.visualDistance + 0.3 * word.pronunciationDistance;
        }

        // åˆ‡æ¢ç¿»è¯‘æ˜¾ç¤º
        function toggleTranslation() {
            const chinese = document.getElementById('wordChinese');
            translationVisible = !translationVisible;
            if (translationVisible) {
                chinese.classList.remove('translation-hidden');
            } else {
                chinese.classList.add('translation-hidden');
            }
        }

        // è¯„åˆ†
        function rateWord(rating) {
            const word = learningWords[currentWordIndex];
            sessionStats.learned++;
            sessionStats[rating]++;

            userProgress.learned.add(word.english);
            if (rating === 'good') {
                userProgress.mastered.add(word.english);
            }

            saveProgress();
            currentWordIndex++;
            showWord();
        }

        // æ˜¾ç¤ºå®Œæˆ
        function showCompletion() {
            document.getElementById('learningView').classList.add('hidden');
            document.getElementById('completionView').classList.remove('hidden');

            document.getElementById('completionLearned').textContent = sessionStats.learned;
            document.getElementById('completionGood').textContent = sessionStats.good;
            document.getElementById('completionNormal').textContent = sessionStats.normal;
            document.getElementById('completionBad').textContent = sessionStats.bad;

            updateStats();
        }

        // è¿”å›é¦–é¡µ
        function returnHome() {
            document.getElementById('completionView').classList.add('hidden');
            document.getElementById('homeView').classList.remove('hidden');
            updateStats();
        }

        // æ¸²æŸ“è¯æ±‡åº“
        function renderLibrary() {
            const wordList = document.getElementById('wordList');
            let html = '';

            vocabularyData.forEach(word => {
                const totalDistance = calculateTotalDistance(word);
                html += `
                    <div class="word-item">
                        <div class="word-item-header">
                            <div>
                                <span class="word-item-title">${word.english}</span>
                                <span class="badge badge-level ${word.level.toLowerCase()}">${word.level}</span>
                                <span class="badge badge-pos">${word.partOfSpeech}</span>
                            </div>
                            <div class="score-value">${totalDistance.toFixed(2)}</div>
                        </div>
                        <div class="word-item-content">
                            <strong>${word.chinese.join('ã€')}</strong><br>
                            ${word.definition}
                        </div>
                    </div>
                `;
            });

            wordList.innerHTML = html;
        }

        // ç­›é€‰è¯æ±‡åº“
        let currentLevelFilter = 'all';
        let currentPosFilter = null;

        function filterByLevel(level) {
            currentLevelFilter = level;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            applyFilters();
        }

        function filterByPos(pos) {
            currentPosFilter = currentPosFilter === pos ? null : pos;
            applyFilters();
        }

        function filterLibrary() {
            applyFilters();
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const wordList = document.getElementById('wordList');
            let html = '';

            const filtered = vocabularyData.filter(word => {
                const matchesLevel = currentLevelFilter === 'all' || word.level === currentLevelFilter;
                const matchesPos = !currentPosFilter || word.partOfSpeech === currentPosFilter;
                const matchesSearch = !searchTerm ||
                    word.english.toLowerCase().includes(searchTerm) ||
                    word.chinese.some(c => c.includes(searchTerm));

                return matchesLevel && matchesPos && matchesSearch;
            });

            filtered.forEach(word => {
                const totalDistance = calculateTotalDistance(word);
                html += `
                    <div class="word-item">
                        <div class="word-item-header">
                            <div>
                                <span class="word-item-title">${word.english}</span>
                                <span class="badge badge-level ${word.level.toLowerCase()}">${word.level}</span>
                                <span class="badge badge-pos">${word.partOfSpeech}</span>
                            </div>
                            <div class="score-value">${totalDistance.toFixed(2)}</div>
                        </div>
                        <div class="word-item-content">
                            <strong>${word.chinese.join('ã€')}</strong><br>
                            ${word.definition}
                        </div>
                    </div>
                `;
            });

            wordList.innerHTML = html || '<p style="text-align:center;padding:40px;color:#999;">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è¯æ±‡</p>';
        }

        // åˆå§‹åŒ–
        loadProgress();
        updateStats();
    </script>
</body>
</html>
